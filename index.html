
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="ourCSS.css"> <!--our style sheet in an external file-->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>

    <!-- <script src="https://d3js.org/d3.v4.min.js"></script>   -->
    <title>Basic Webpage for our censorship measurement system</title>


  </head>
  <body>
      <!-- this will be where we visualize the database results -->
 
      
    <h1 class="center">Our TestWebpage</h1>









      <button type="button" onclick="loadDoc()">Complete measurement task</button>
    
      <div id="footer"></div>


      <div id="testingDiv"></div>

      <!-- TESTING SCRIPT -->
      <script> 
      var CensorshipObject = new Object();

        CensorshipObject.sendSuccess = function()
        {
        console.log("image was loaded correctly");
        CensorshipObject.submitResult("success");
        // #######################BETA CODE########################
      }
      CensorshipObject.submitResult = function(message){
        var result_json = { "measurement_id" : CensorshipObject.myID,"result_status" : message};

        // console.log(result_json); DEBUGGING
        // console.log(JSON.stringify(result_json));
        //TRY 1
        // $.ajax({
        //     type: "POST",
        //     url: "/submit", //TODO this should be changed to absolute url.
        //     // The key needs to match your method's input parameter (case-sensitive).
        //     data: JSON.stringify(result_json),
        //     contentType: "application/json; charset=utf-8",
        //     dataType: "json"
        //     });

        ////TRY 2
        // $.ajax({
        //   url: "/submit" + "?" + $.param(result_json),
        //  });

        ////TRY 3
        $.ajax({
            url: "/submit",
            type: "POST",
            data: JSON.stringify({ "measurement_id" : 99999999,"result_status" : message}),
            contentType: "application/json"
        });
        // #######################BETA CODE########################
        }
        CensorshipObject.sendFailure = function()
        {
        console.log("image failed to load correctly");
        // this.submitResult("failure");
        }
        CensorshipObject.measure = function() {
        var img = new Image(); // width, height values are optional params
        img.src = "https://docs.python.org/3/_static/py.png"; //DEBUGGGING
        img.onerror = CensorshipObject.sendFailure;
        img.onload = CensorshipObject.sendSuccess;
        // img.css('display', 'none');   //hide the image we are loading

        CensorshipObject.myID =3; //DEBUGGING
        document.getElementById("footer").appendChild(img);

        }
        CensorshipObject.measure();
     
      </script>
      
      <!-- script to deal with the loading of the the measurement task when button is clicked -->
    <script>
          function loadDoc() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() 
            {
              if (this.readyState == 4 && this.status == 200) 
              {
                var res = document.getElementById("footer").innerHTML =this.responseText;
                
                
                // console.log(document.getElementById('sc1'));
                
                
                eval(document.getElementById('sc1').innerHTML); //actually register new javascript with browser

                CensorshipObject.measure();
                
                
                
              }
          };
          // TODO THIS SHOULD BE A ABSOLUTE URL NOT a relative URL because client
          xhttp.open("GET", "/task.js", true);
          xhttp.send();
    }
      
      
      
      
    </script>

    </body>
</html>
